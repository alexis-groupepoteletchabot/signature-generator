<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>G√©n√©rateur de signature ‚Äì Potel & Chabot</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      color: #000;
    }
    h1 {
      text-align: center;
      color: #000;
      margin-bottom: 30px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-top: 15px;
      color: #000;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .buttons {
      text-align: center;
      margin: 20px 0;
    }
    button {
      padding: 12px 20px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    .copy-btn {
      background: #0066cc;
      color: white;
    }
    .outlook-web-btn {
      background: #0078d4;
      color: white;
    }
    .outlook-app-btn {
      background: #106ebe;
      color: white;
    }
    .download-btn {
      background: #28a745;
      color: white;
    }
    #preview {
      border: 1px solid #ddd;
      padding: 20px;
      margin-top: 20px;
      background: #f9f9f9;
      min-height: 100px;
    }
    .instructions {
      background: #e6f3ff;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>G√©n√©rateur de signature ‚Äì Potel & Chabot</h1>

  <form id="form">
    <label>Pr√©nom</label>
    <input type="text" id="firstName" placeholder="Ex : Ang√®le">

    <label>Nom</label>
    <input type="text" id="lastName" placeholder="Ex : Havard">

    <label>Marque</label>
    <select id="brand">
      <option value="groupe">Groupe Potel & Chabot</option>
      <option value="potel">Potel & Chabot</option>
    </select>

    <label>Service (optionnel)</label>
    <input type="text" id="service" placeholder="Ex : SPORTS & ENTERTAINMENT">

    <label>Poste</label>
    <input type="text" id="jobTitle" placeholder="Ex : Directrice Marketing">

    <label>Adresse</label>
    <input type="text" id="address" value="3 rue de Chaillot ‚Äî PARIS XVI">

    <label>Email</label>
    <input type="email" id="email" placeholder="prenom.nom@poteletchabot.fr">

    <label>T√©l√©phone principal</label>
    <input type="text" id="phone1" placeholder="+33 1 00 00 00 00">

    <label>T√©l√©phone secondaire (optionnel)</label>
    <input type="text" id="phone2" placeholder="+33 6 00 00 00 00">
  </form>

  <div class="buttons">
    <button class="copy-btn" onclick="copySignature()">üìã Copier la signature</button>
    <button class="download-btn" onclick="downloadSignature()">üíæ T√©l√©charger HTML</button>
    <button class="outlook-web-btn" onclick="openOutlookWeb()">üåê Ouvrir Outlook Web</button>
    <button class="outlook-app-btn" onclick="openOutlookApp()">üìß Ouvrir l'app Outlook</button>
  </div>

  <div class="instructions">
    <strong>Instructions :</strong> Remplissez le formulaire, copiez votre signature, puis collez-la dans Outlook.
  </div>

  <div id="preview">
    <p>Votre signature appara√Ætra ici...</p>
  </div>

  <script>
    var logoGroupe = "https://pub-931fda2ddb7a4c2bbec8e89d1253445c.r2.dev/Logo_Groupe_Mail.png";
    var logoPotel = "https://pub-931fda2ddb7a4c2bbec8e89d1253445c.r2.dev/Logo_Potel_Mail.png";

    function formatPhone(phone) {
      if (!phone) return "";
      var cleaned = phone.replace(/[^\d+]/g, "");
      
      if (cleaned.indexOf("+33") === 0) {
        var digits = cleaned.substring(3);
        if (digits.length >= 9) {
          return "+33 " + digits.charAt(0) + " " + digits.substring(1, 3) + " " + 
                 digits.substring(3, 5) + " " + digits.substring(5, 7) + " " + digits.substring(7, 9);
        }
      } else if (cleaned.indexOf("0") === 0 && cleaned.length >= 10) {
        return cleaned.substring(0, 2) + " " + cleaned.substring(2, 4) + " " + 
               cleaned.substring(4, 6) + " " + cleaned.substring(6, 8) + " " + cleaned.substring(8, 10);
      }
      
      return phone;
    }

    function updatePreview() {
      var firstName = document.getElementById("firstName").value || "PR√âNOM";
      var lastName = document.getElementById("lastName").value || "NOM";
      var brand = document.getElementById("brand").value;
      var service = document.getElementById("service").value;
      var jobTitle = document.getElementById("jobTitle").value || "Poste";
      var address = document.getElementById("address").value;
      var email = document.getElementById("email").value || "email@exemple.com";
      var phone1 = document.getElementById("phone1").value;
      var phone2 = document.getElementById("phone2").value;

      var isGroupe = brand === "groupe";
      var font = isGroupe ? "Arial, sans-serif" : "Times, serif";
      
      var firstNameUpper = firstName.toUpperCase();
      var lastNameUpper = lastName.toUpperCase();
      var jobTitleUpper = isGroupe ? jobTitle.toUpperCase() : jobTitle;
      
      var phones = "";
      if (phone1 && phone2) {
        phones = formatPhone(phone1) + " ‚Äî " + formatPhone(phone2);
      } else if (phone1 || phone2) {
        phones = formatPhone(phone1 || phone2);
      }

      var cleanService = service.replace(/^\s+|\s+$/g, "");
      var serviceHtml = "";
      if (cleanService) {
        if (isGroupe) {
          serviceHtml = '<div style="display:inline-block; background:#000000; color:#ffffff; font-size:12pt; font-weight:bold; text-transform:uppercase; padding:4px 8px; margin-top:1px; letter-spacing:0px;">' + cleanService.toUpperCase() + '</div>';
        } else {
          serviceHtml = " ‚Äî " + cleanService;
        }
      }

      var html = "";
      
      if (isGroupe) {
        // GROUPE - Interligne r√©duit √† 18px, email sans lien
        html = '<div style="font-family:' + font + '; font-size:12pt; color:#000000 !important; max-width:600px; line-height:1.2;">' +
               '<div style="font-size:12pt; font-weight:bold; color:#000000 !important; margin:0; padding:0; margin-bottom:1px;">' + firstNameUpper + ' ' + lastNameUpper + '</div>' +
               serviceHtml +
               '<div style="font-size:12pt; font-weight:bold; color:#000000 !important; margin:0; padding:0; margin-top:1px; margin-bottom:18px;">' + jobTitleUpper + '</div>' +
               (phones ? '<div style="font-size:12pt; font-weight:bold; color:#000000 !important; margin:0; padding:0; margin-bottom:1px;">' + phones + '</div>' : '') +
               '<div style="font-size:12pt; font-weight:bold; color:#000000 !important; margin:0; padding:0; margin-top:1px; margin-bottom:1px;"><span style="color:#000000 !important; text-decoration:none;">' + email + '</span></div>' +
               '<div style="font-size:12pt; font-weight:bold; color:#000000 !important; margin:0; padding:0; margin-top:1px;">' + address + '</div>' +
               '<table style="margin-top:14px; margin-bottom:0; border-collapse:collapse;" cellpadding="0" cellspacing="0" border="0"><tr><td style="background-color:#ffffff; padding:8px;"><img src="' + logoGroupe + '" alt="Groupe Potel & Chabot" style="display:block; border:none; max-width:100%; height:auto; width:311px;" width="311"></td></tr></table>' +
               '</div>';
      } else {
        // POTEL - Email sans lien
        var emailLine = email;
        var phonesLine = "";
        
        if (phone1 && phone2) {
          phonesLine = '<div style="font-size:12pt; color:#000000 !important; margin:0; padding:0; margin-top:3px;">' + phones + '</div>';
        } else if (phone1 || phone2) {
          emailLine = email + " ‚Äî " + formatPhone(phone1 || phone2);
        }

        html = '<table style="width:100%; max-width:750px; border-collapse:collapse; font-family:' + font + '; font-size:12pt; color:#000000;" cellpadding="0" cellspacing="0" border="0">' +
               '<tr>' +
               '<td style="vertical-align:middle; padding-right:15px; width:320px; padding:0;">' +
               '<img src="' + logoPotel + '" alt="Potel & Chabot" style="display:block; border:none; width:320px; height:98px; max-width:100%; height:auto;" width="320" height="98">' +
               '</td>' +
               '<td style="width:1px; background-color:#bbbbbb; vertical-align:middle; padding:0;"><div style="width:1px; height:98px; background-color:#bbbbbb; font-size:1px; line-height:1px;">&nbsp;</div></td>' +
               '<td style="vertical-align:middle; padding-left:15px; padding-top:0; padding-bottom:0; padding-right:0;">' +
               '<div style="font-size:14pt; font-weight:bold; color:#000000 !important; margin:0; padding:0;">' + firstNameUpper + ' ' + lastNameUpper + '</div>' +
               '<div style="font-size:12pt; color:#000000 !important; margin:0; padding:0; margin-top:2px;">' + jobTitle + serviceHtml + '</div>' +
               '<div style="font-size:12pt; color:#000000 !important; margin:0; padding:0; margin-top:3px;">' + address + '</div>' +
               '<div style="font-size:12pt; color:#000000 !important; margin:0; padding:0; margin-top:3px;"><span style="color:#000000 !important; text-decoration:none;">' + emailLine + '</span></div>' +
               phonesLine +
               '</td></tr></table>';
      }

      document.getElementById("preview").innerHTML = html;
    }

    async function copySignature() {
      var html = document.getElementById("preview").innerHTML;
      
      try {
        var blob = new Blob([html], { type: 'text/html' });
        var clipboardItem = new ClipboardItem({ 'text/html': blob });
        await navigator.clipboard.write([clipboardItem]);
        alert("‚úÖ Signature copi√©e avec formatage ! Vous pouvez la coller dans Outlook.");
      } catch (e) {
        try {
          await navigator.clipboard.writeText(html);
          alert("‚úÖ Signature copi√©e (code HTML). Collez dans Outlook et le formatage sera appliqu√©.");
        } catch (e2) {
          alert("‚ùå Copie automatique impossible.\n\nS√©lectionnez manuellement le contenu de l'aper√ßu et copiez-le (Ctrl+C).");
        }
      }
    }

    function downloadSignature() {
      var html = document.getElementById("preview").innerHTML;
      var fullHtml = '<!DOCTYPE html>\n<html>\n<head>\n<meta charset="UTF-8">\n<title>Signature Email</title>\n</head>\n<body>\n' + html + '\n</body>\n</html>';
      
      var blob = new Blob([fullHtml], { type: 'text/html' });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'signature-email.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert("‚úÖ Fichier HTML t√©l√©charg√© !");
    }

    function openOutlookWeb() {
      var url = "https://outlook.office.com/mail/options/mail/messageFormat";
      window.open(url, '_blank');
      alert("üåê Outlook Web s'ouvre dans un nouvel onglet.\nAllez dans Param√®tres > Signature et collez votre signature !");
    }

    function openOutlookApp() {
      var userAgent = navigator.userAgent || navigator.vendor || window.opera;
      
      var isMobile = /android|iphone|ipad|ipod/i.test(userAgent.toLowerCase());
      
      if (isMobile) {
        window.location.href = "ms-outlook://";
        
        setTimeout(function() {
          if (/android/i.test(userAgent)) {
            window.location.href = "https://play.google.com/store/apps/details?id=com.microsoft.office.outlook";
          } else if (/iphone|ipad|ipod/i.test(userAgent)) {
            window.location.href = "https://apps.apple.com/app/microsoft-outlook/id951937596";
          }
        }, 1500);
        
        alert("üì± Tentative d'ouverture de l'app Outlook mobile...\nSi l'app ne s'ouvre pas, vous serez redirig√© vers le store.");
      } else {
        window.location.href = "outlook:";
        
        alert("üíª Tentative d'ouverture du client Outlook desktop...\n\nSi cela ne fonctionne pas, ouvrez Outlook manuellement et allez dans :\nFichier > Options > Courrier > Signatures");
      }
    }

    var inputs = document.querySelectorAll("input, select");
    for (var i = 0; i < inputs.length; i++) {
      inputs[i].addEventListener("input", updatePreview);
      inputs[i].addEventListener("change", updatePreview);
    }

    updatePreview();
  </script>
</body>
</html>
