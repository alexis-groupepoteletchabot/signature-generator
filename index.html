<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Générateur de signature – Potel & Chabot</title>
  <style>
    :root { color-scheme: light; }
    html, body {
      margin: 0;
      padding: 0;
      background: #fff;
      color: #000;
      font-family: Arial, Helvetica, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .container {
      max-width: 980px;
      margin: 32px auto;
      padding: 0 16px;
      color: #000;
    }
    h1 {
      font-size: 22px;
      margin: 0 0 20px 0;
      text-align: center;
      color: #000;
      font-weight: 700;
    }
    form label {
      display: block;
      font-weight: 600;
      margin-top: 10px;
      color: #000;
    }
    form input, form select {
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      color: #000;
      background: #fff;
    }
    .actions {
      text-align: center;
      margin-top: 16px;
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }
    button {
      cursor: pointer;
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      color: #fff;
      background: #0b57d0;
      font-size: 14px;
    }
    button.secondary { background: #555; }
    #previewContainer {
      margin-top: 28px;
      border: 1px solid #e5e5e5;
      background: #fff;
    }
    #previewHeader {
      background: #f7f7f7;
      border-bottom: 1px solid #e5e5e5;
      padding: 10px 14px;
      font-weight: 600;
      color: #000;
    }
    #preview {
      padding: 18px 14px;
      background: #fff;
      color: #000;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Générateur de signature – Potel & Chabot</h1>

    <form id="signatureForm" onsubmit="return false;">
      <label for="firstName">Prénom</label>
      <input id="firstName" type="text" placeholder="Ex : Angèle"/>

      <label for="lastName">Nom</label>
      <input id="lastName" type="text" placeholder="Ex : Havard"/>

      <label for="brand">Marque</label>
      <select id="brand">
        <option value="groupe">Groupe Potel & Chabot</option>
        <option value="potel">Potel & Chabot</option>
      </select>

      <label for="service">Service (optionnel)</label>
      <input id="service" type="text" placeholder="Ex : SPORTS &amp; ENTERTAINMENT"/>

      <label for="jobTitle">Poste</label>
      <input id="jobTitle" type="text" placeholder="Ex : Directrice Marketing"/>

      <label for="address">Adresse</label>
      <input id="address" type="text" value="3 rue de Chaillot — PARIS XVI"/>

      <label for="email">Email</label>
      <input id="email" type="email" placeholder="prenom.nom@poteletchabot.fr"/>

      <label for="phone1">Téléphone principal</label>
      <input id="phone1" type="text" placeholder="+33 1 00 00 00 00"/>

      <label for="phone2">Téléphone secondaire (optionnel)</label>
      <input id="phone2" type="text" placeholder="+33 6 00 00 00 00"/>
    </form>

    <div class="actions">
      <button type="button" onclick="copySignature()">Copier la signature</button>
      <button type="button" class="secondary" onclick="downloadHTM()">Télécharger (.htm)</button>
    </div>

    <div id="previewContainer">
      <div id="previewHeader">Aperçu</div>
      <div id="preview">Votre signature apparaîtra ici…</div>
    </div>
  </div>

  <script>
    // LOGOS (remplace par tes base64 complets)
    const logoGroupe = "REPLACE_WITH_BASE64_LOGO_GROUPE";
    const logoPotel  = "REPLACE_WITH_BASE64_LOGO_POTEL";

    // Séparateur cadratin pour téléphones
    const formatPhones = (p1, p2) => {
      const a = (p1 || "").trim();
      const b = (p2 || "").trim();
      if (a && b) return `${a} — ${b}`;
      return a || b || "";
    };

    function updatePreview() {
      const data = {
        firstName: document.getElementById("firstName").value.trim(),
        lastName:  document.getElementById("lastName").value.trim(),
        brand:     document.getElementById("brand").value,
        service:   document.getElementById("service").value.trim(),
        jobTitle:  document.getElementById("jobTitle").value.trim(),
        address:   document.getElementById("address").value.trim(),
        email:     document.getElementById("email").value.trim(),
        phone1:    document.getElementById("phone1").value.trim(),
        phone2:    document.getElementById("phone2").value.trim(),
      };

      // Polices et styles par marque
      const isGroupe = data.brand === "groupe";
      const fontFamily = isGroupe
        ? "Arial, Helvetica, sans-serif"
        : "Times, 'Times New Roman', serif"; // Potel
      const color = "#000";

      // SERVICE (supprimer espaces parasites)
      const cleanService = data.service.replace(/^\s+|\s+$/g, "");
      let serviceHtml = "";
      if (cleanService) {
        if (isGroupe) {
          // Pill noire, texte blanc, uppercase, gras — sans espaces de part et d'autre
          serviceHtml = `
            <div style="
              display:inline-block; background:#000; color:#fff;
              font-size:10pt; font-weight:bold; text-transform:uppercase; line-height:1;
              padding:4px 8px; margin-top:6px; letter-spacing:0.2px;">
              ${cleanService}
            </div>`;
        } else {
          // Potel: affiché sur la ligne du poste
          serviceHtml = ` — ${cleanService}`;
        }
      }

      // TÉLÉPHONES
      const phones = formatPhones(data.phone1, data.phone2);

      // BLOC TEXTE GROUPE
      // Ordre: Nom → Service → Poste → Téléphone → Email → Adresse
      // Tout en gras (10pt), poste non italique
      const textHtmlGroupe = `
        <div style="font-family:${fontFamily}; color:${color};">
          <div style="font-size:12pt; font-weight:bold; text-transform:uppercase;">
            ${data.firstName} ${data.lastName}
          </div>
          ${serviceHtml || ""}
          <div style="font-size:10pt; font-weight:bold; margin-top:6px;">
            ${data.jobTitle}
          </div>
          ${phones ? `<div style="font-size:10pt; font-weight:bold; margin-top:6px;">${phones}</div>` : ""}
          <div style="font-size:10pt; font-weight:bold; margin-top:6px;">${data.email}</div>
          <div style="font-size:10pt; font-weight:bold; margin-top:6px;">${data.address}</div>
        </div>
      `;

      // BLOC TEXTE POTEL
      // Nom/Prénom 12pt uppercase gras; poste non italique
      // Adresse, email, puis:
      // - si 1 seul numéro: email — téléphone sur UNE LIGNE
      // - si 2 numéros: téléphones sur LIGNE SUIVANTE
      const onePhoneOnly = !!(data.phone1 && !data.phone2) || (!!data.phone2 && !data.phone1);
      const hasTwoPhones = !!(data.phone1 && data.phone2);

      // Ligne email (+ éventuel téléphone si un seul)
      const emailLine = onePhoneOnly
        ? `${data.email} — ${data.phone1 || data.phone2}`
        : data.email;

      // Ligne téléphones (seulement si deux)
      const phonesBelowHtml = hasTwoPhones
        ? `<div style="font-size:10pt; margin-top:6px;">${formatPhones(data.phone1, data.phone2)}</div>`
        : "";

      const textHtmlPotel = `
        <div style="font-family:${fontFamily}; color:${color};">
          <div style="font-size:12pt; font-weight:bold; text-transform:uppercase;">
            ${data.firstName} ${data.lastName}
          </div>
          <div style="font-size:10pt; margin-top:6px;">
            ${data.jobTitle}${serviceHtml || ""}
          </div>
          <div style="font-size:10pt; margin-top:6px;">${data.address}</div>
          <div style="font-size:10pt; margin-top:6px;">${emailLine}</div>
          ${phonesBelowHtml}
        </div>
      `;

      // MISE EN PAGE
      let html = "";
      if (isGroupe) {
        // Texte puis logo groupe en dessous
        html = `
          <table cellpadding="0" cellspacing="0" border="0" style="font-family:${fontFamily}; color:${color}; font-size:10pt;">
            <tr>
              <td style="vertical-align:top;">
                ${textHtmlGroupe}
                <div style="margin-top:14px;">
                  <img src="${logoGroupe}" width="311" height="76" style="display:block; border:none;">
                </div>
              </td>
            </tr>
          </table>
        `;
      } else {
        // POTEL: logo à gauche, barre verticale plus haute, texte aligné à mi-hauteur du logo
        // Hauteur de barre > logo (90px) pour coller au visuel
        // Alignement: on utilise vertical-align:middle et un léger offset top si besoin
        html = `
          <table cellpadding="0" cellspacing="0" border="0" style="font-family:${fontFamily}; color:${color}; font-size:10pt;">
            <tr>
              <!-- Logo -->
              <td style="vertical-align:middle; padding-right:16px;">
                <img src="${logoPotel}" width="248" height="76" style="display:block; border:none;">
              </td>

              <!-- Barre verticale (plus grande) -->
              <td style="width:1px; background:#000; opacity:0.35;">
                <div style="width:1px; height:90px; line-height:0; font-size:0;">&nbsp;</div>
              </td>

              <!-- Espace après barre -->
              <td style="width:16px; line-height:0; font-size:0;">&nbsp;</td>

              <!-- Texte (aligné sur la ligne de texte du logo) -->
              <td style="vertical-align:middle;">
                ${textHtmlPotel}
              </td>
            </tr>
          </table>
        `;
      }

      document.getElementById("preview").innerHTML = html;
    }

    document.querySelectorAll("#signatureForm input, #signatureForm select")
      .forEach(el => el.addEventListener("input", updatePreview));
    updatePreview();

    // Copier HTML
    async function copySignature() {
      const html = document.getElementById("preview").innerHTML;
      const blob = new Blob([html], { type: "text/html" });
      try {
        await navigator.clipboard.write([new ClipboardItem({ "text/html": blob })]);
        alert("Signature copiée (HTML) !");
      } catch (e) {
        try {
          await navigator.clipboard.writeText(html);
          alert("Signature copiée en texte (fallback).");
        } catch {
          alert("Copie automatique non supportée.");
        }
      }
    }

    // Télécharger .htm
    function downloadHTM() {
      const inner = document.getElementById("preview").innerHTML;
      const full = `<!DOCTYPE html><html><head><meta charset="UTF-8"></head><body>${inner}</body></html>`;
      const blob = new Blob([full], { type: "text/html" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "signature-potel-groupe.htm";
      a.click();
      setTimeout(() => URL.revokeObjectURL(a.href), 1000);
    }
  </script>
</body>
</html>
